<div style="max-width:760px;font-family:Segoe UI, Arial, sans-serif; line-height:1.3;">
  <h3 style="margin:0 0 10px;">Calculateur ‚Äì Note du crit√®re Prix</h3>
  <p style="margin:0 0 12px; color:#444;">
    Entrez ci-dessous le montant hors taxe qui figure sur chaque proposition financi√®re que vous avez re√ßue. L'outil calcule automatiquement la note sur 10 de chaque candidat, et la note pond√©r√©e du crit√®re financier. 
    Vous pouvez √©galement calculer la note pond√©r√©e, selon l'importance que vous choisissez de donner au crit√®re prix dans votre √©valuation. <strong>Note prix (/10) = (Prix le plus bas / Prix de l‚Äôoffre) √ó 10</strong><br>
    La note pond√©r√©e = Note prix √ó (Pond√©ration du crit√®re prix / 100).
  </p>

  <div style="margin:8px 0 12px; display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
    <label for="ponderationPrix"><strong>Pond√©ration du crit√®re prix (%)</strong></label>
    <input id="ponderationPrix" type="number" min="0" max="100" value="40" style="width:90px; padding:4px;">
    <span id="sumCheck" style="color:#666;"></span>
  </div>

  <table id="priceTable" border="1" cellpadding="6" cellspacing="0" style="border-collapse:collapse; width:100%;">
    <thead>
      <tr style="background:#f2f2f2;">
        <th style="text-align:left;">Candidat / Offre</th>
        <th style="text-align:right;">Prix (‚Ç¨ HT)</th>
        <th style="text-align:right;">Prix le + bas (‚Ç¨)</th>
        <th style="text-align:right;">Note prix /10</th>
        <th style="text-align:right;">Note pond√©r√©e</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="priceBody">
      <tr>
        <td><input type="text" placeholder="Offre 1" value="Candidat A" style="width:100%;"></td>
        <td><input type="number" class="prix" min="0.0001" step="0.01" value="10000" style="width:120px; text-align:right;"></td>
        <td class="minRef" style="text-align:right;">‚Äî</td>
        <td class="note10" style="text-align:right;">‚Äî</td>
        <td class="notePonderee" style="text-align:right;">‚Äî</td>
        <td style="text-align:center;"><button class="delRow" title="Supprimer">üóëÔ∏è</button></td>
      </tr>
      <tr>
        <td><input type="text" placeholder="Offre 2" value="Candidat B" style="width:100%;"></td>
        <td><input type="number" class="prix" min="0.0001" step="0.01" value="12000" style="width:120px; text-align:right;"></td>
        <td class="minRef" style="text-align:right;">‚Äî</td>
        <td class="note10" style="text-align:right;">‚Äî</td>
        <td class="notePonderee" style="text-align:right;">‚Äî</td>
        <td style="text-align:center;"><button class="delRow" title="Supprimer">üóëÔ∏è</button></td>
      </tr>
      <tr>
        <td><input type="text" placeholder="Offre 3" value="Candidat C" style="width:100%;"></td>
        <td><input type="number" class="prix" min="0.0001" step="0.01" value="15000" style="width:120px; text-align:right;"></td>
        <td class="minRef" style="text-align:right;">‚Äî</td>
        <td class="note10" style="text-align:right;">‚Äî</td>
        <td class="notePonderee" style="text-align:right;">‚Äî</td>
        <td style="text-align:center;"><button class="delRow" title="Supprimer">üóëÔ∏è</button></td>
      </tr>
    </tbody>
    <tfoot>
      <tr style="background:#fafafa;">
        <td colspan="3" style="text-align:right; font-weight:bold;">Rappel : Pond√©ration prix (%)</td>
        <td colspan="2" style="text-align:right;">
          <span id="pondEcho">40</span> %
        </td>
        <td></td>
      </tr>
    </tfoot>
  </table>

  <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
    <button id="addRow">‚ûï Ajouter une offre</button>
    <button id="resetVals" title="R√©initialiser les valeurs">‚Ü∫ R√©initialiser</button>
  </div>

  <p id="alertMsg" style="margin-top:10px; color:#b00020; display:none;"></p>
</div>

<script>
  (function(){
    const body = document.getElementById('priceBody');
    const addRowBtn = document.getElementById('addRow');
    const resetBtn = document.getElementById('resetVals');
    const pondInput = document.getElementById('ponderationPrix');
    const pondEcho = document.getElementById('pondEcho');
    const alertMsg = document.getElementById('alertMsg');

    function parsePosFloat(v){
      const x = parseFloat((v||"").toString().replace(",", "."));
      return (isNaN(x) || x <= 0) ? null : x;
    }

    function compute(){
      alertMsg.style.display = 'none';
      alertMsg.textContent = '';

      // Collect prices
      const rows = Array.from(body.querySelectorAll('tr'));
      const prices = rows.map(r => parsePosFloat(r.querySelector('.prix').value)).filter(v => v !== null);

      if(prices.length === 0){
        // No valid price
        rows.forEach(r => {
          r.querySelector('.minRef').textContent = '‚Äî';
          r.querySelector('.note10').textContent = '‚Äî';
          r.querySelector('.notePonderee').textContent = '‚Äî';
        });
        return;
      }

      const minPrice = Math.min(...prices);
      const pond = Math.min(100, Math.max(0, parseFloat(pondInput.value) || 0));
      pondEcho.textContent = pond.toString();

      // Update per row
      rows.forEach(r => {
        const priceInput = r.querySelector('.prix');
        const minRefCell = r.querySelector('.minRef');
        const note10Cell = r.querySelector('.note10');
        const notePondCell = r.querySelector('.notePonderee');

        const price = parsePosFloat(priceInput.value);

        minRefCell.textContent = isFinite(minPrice) ? minPrice.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2}) : '‚Äî';

        if(price === null){
          note10Cell.textContent = '‚Äî';
          notePondCell.textContent = '‚Äî';
          return;
        }

        // Note (/10) = (min / price) * 10
        const rawNote = (minPrice / price) * 10;
        const note10 = Math.max(0, Math.min(10, rawNote));
        const notePonderee = note10 * (pond / 100);

        note10Cell.textContent = note10.toFixed(2);
        notePondCell.textContent = notePonderee.toFixed(2);
      });

      // Basic guardrail
      if(minPrice <= 0){
        alertMsg.textContent = "Les prix doivent √™tre strictement positifs.";
        alertMsg.style.display = 'block';
      }
    }

    function addRow(){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="text" placeholder="Offre" style="width:100%;"></td>
        <td><input type="number" class="prix" min="0.0001" step="0.01" value="" style="width:120px; text-align:right;"></td>
        <td class="minRef" style="text-align:right;">‚Äî</td>
        <td class="note10" style="text-align:right;">‚Äî</td>
        <td class="notePonderee" style="text-align:right;">‚Äî</td>
        <td style="text-align:center;"><button class="delRow" title="Supprimer">üóëÔ∏è</button></td>
      `;
      body.appendChild(tr);
      attachRowEvents(tr);
      compute();
    }

    function attachRowEvents(tr){
      const inputs = tr.querySelectorAll('input');
      inputs.forEach(inp => inp.addEventListener('input', compute));
      const delBtn = tr.querySelector('.delRow');
      if(delBtn){
        delBtn.addEventListener('click', () => {
          tr.remove();
          compute();
        });
      }
    }

    // Attach existing rows
    Array.from(body.querySelectorAll('tr')).forEach(attachRowEvents);

    // Global events
    addRowBtn.addEventListener('click', addRow);
    resetBtn.addEventListener('click', () => {
      // Reset to 3 rows with placeholders
      body.innerHTML = '';
      ['Candidat A','Candidat B','Candidat C'].forEach((label, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="text" value="${label}" placeholder="Offre ${idx+1}" style="width:100%;"></td>
          <td><input type="number" class="prix" min="0.0001" step="0.01" value="" style="width:120px; text-align:right;"></td>
          <td class="minRef" style="text-align:right;">‚Äî</td>
          <td class="note10" style="text-align:right;">‚Äî</td>
          <td class="notePonderee" style="text-align:right;">‚Äî</td>
          <td style="text-align:center;"><button class="delRow" title="Supprimer">üóëÔ∏è</button></td>
        `;
        body.appendChild(tr);
        attachRowEvents(tr);
      });
      pondInput.value = 40;
      pondEcho.textContent = '40';
      compute();
    });

    pondInput.addEventListener('input', compute);

    // First compute
    compute();
  })();
</script>

<div style="max-width:600px;font-family:Arial;">
  <h3>Calculateur de pond√©ration - Candidat 1</h3>

  <table border="1" cellpadding="6" cellspacing="0" style="border-collapse:collapse;width:100%;">
    <thead>
      <tr style="background:#f2f2f2;">
        <th>Crit√®re</th>
        <th>Pond√©ration (%)</th>
        <th>Note /10</th>
        <th>Score pond√©r√©</th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td><input type="text" placeholder="Crit√®re 1" style="width:100%;"></td>
        <td><input type="number" class="pond" value="40" min="0" max="100" style="width:80px;"></td>
        <td><input type="number" class="note" value="0" min="0" max="10" style="width:80px;"></td>
        <td class="result">0</td>
      </tr>

      <tr>
        <td><input type="text" placeholder="Crit√®re 2" style="width:100%;"></td>
        <td><input type="number" class="pond" value="30" min="0" max="100" style="width:80px;"></td>
        <td><input type="number" class="note" value="0" min="0" max="10" style="width:80px;"></td>
        <td class="result">0</td>
      </tr>

      <tr>
        <td><input type="text" placeholder="Crit√®re 3" style="width:100%;"></td>
        <td><input type="number" class="pond" value="30" min="0" max="100" style="width:80px;"></td>
        <td><input type="number" class="note" value="0" min="0" max="10" style="width:80px;"></td>
        <td class="result">0</td>
      </tr>
    </tbody>
  </table>

  <h4>Note globale pond√©r√©e : <span id="total" style="font-weight:bold;">0</span> / 10</h4>
</div>

<script>
  function calculer() {
    const pond = document.querySelectorAll(".pond");
    const note = document.querySelectorAll(".note");
    const results = document.querySelectorAll(".result");
    let total = 0;

    for (let i = 0; i < pond.length; i++) {
      const p = parseFloat(pond[i].value) / 100;
      const n = parseFloat(note[i].value);
      const score = (p * n).toFixed(2);
      results[i].innerText = score;
      total += parseFloat(score);
    }

    document.getElementById("total").innerText = total.toFixed(2);
  }

  document.querySelectorAll("input").forEach(input => {
    input.addEventListener("input", calculer);
  });

  calculer();
</script>

<div style="max-width:600px;font-family:Arial;">
  <h3>Calculateur de pond√©ration - Candidat 2</h3>

  <table border="1" cellpadding="6" cellspacing="0" style="border-collapse:collapse;width:100%;">
    <thead>
      <tr style="background:#f2f2f2;">
        <th>Crit√®re</th>
        <th>Pond√©ration (%)</th>
        <th>Note /10</th>
        <th>Score pond√©r√©</th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td><input type="text" placeholder="Crit√®re 1" style="width:100%;"></td>
        <td><input type="number" class="pond" value="40" min="0" max="100" style="width:80px;"></td>
        <td><input type="number" class="note" value="0" min="0" max="10" style="width:80px;"></td>
        <td class="result">0</td>
      </tr>

      <tr>
        <td><input type="text" placeholder="Crit√®re 2" style="width:100%;"></td>
        <td><input type="number" class="pond" value="30" min="0" max="100" style="width:80px;"></td>
        <td><input type="number" class="note" value="0" min="0" max="10" style="width:80px;"></td>
        <td class="result">0</td>
      </tr>

      <tr>
        <td><input type="text" placeholder="Crit√®re 3" style="width:100%;"></td>
        <td><input type="number" class="pond" value="30" min="0" max="100" style="width:80px;"></td>
        <td><input type="number" class="note" value="0" min="0" max="10" style="width:80px;"></td>
        <td class="result">0</td>
      </tr>
    </tbody>
  </table>

  <h4>Note globale pond√©r√©e : <span id="total" style="font-weight:bold;">0</span> / 10</h4>
</div>

<script>
  function calculer() {
    const pond = document.querySelectorAll(".pond");
    const note = document.querySelectorAll(".note");
    const results = document.querySelectorAll(".result");
    let total = 0;

    for (let i = 0; i < pond.length; i++) {
      const p = parseFloat(pond[i].value) / 100;
      const n = parseFloat(note[i].value);
      const score = (p * n).toFixed(2);
      results[i].innerText = score;
      total += parseFloat(score);
    }

    document.getElementById("total").innerText = total.toFixed(2);
  }

  document.querySelectorAll("input").forEach(input => {
    input.addEventListener("input", calculer);
  });

  calculer();
</script>

<div style="max-width:600px;font-family:Arial;">
  <h3>Calculateur de pond√©ration - Candidat 3</h3>

  <table border="1" cellpadding="6" cellspacing="0" style="border-collapse:collapse;width:100%;">
    <thead>
      <tr style="background:#f2f2f2;">
        <th>Crit√®re</th>
        <th>Pond√©ration (%)</th>
        <th>Note /10</th>
        <th>Score pond√©r√©</th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td><input type="text" placeholder="Crit√®re 1" style="width:100%;"></td>
        <td><input type="number" class="pond" value="40" min="0" max="100" style="width:80px;"></td>
        <td><input type="number" class="note" value="0" min="0" max="10" style="width:80px;"></td>
        <td class="result">0</td>
      </tr>

      <tr>
        <td><input type="text" placeholder="Crit√®re 2" style="width:100%;"></td>
        <td><input type="number" class="pond" value="30" min="0" max="100" style="width:80px;"></td>
        <td><input type="number" class="note" value="0" min="0" max="10" style="width:80px;"></td>
        <td class="result">0</td>
      </tr>

      <tr>
        <td><input type="text" placeholder="Crit√®re 3" style="width:100%;"></td>
        <td><input type="number" class="pond" value="30" min="0" max="100" style="width:80px;"></td>
        <td><input type="number" class="note" value="0" min="0" max="10" style="width:80px;"></td>
        <td class="result">0</td>
      </tr>
    </tbody>
  </table>

  <h4>Note globale pond√©r√©e : <span id="total" style="font-weight:bold;">0</span> / 10</h4>
</div>

<script>
  function calculer() {
    const pond = document.querySelectorAll(".pond");
    const note = document.querySelectorAll(".note");
    const results = document.querySelectorAll(".result");
    let total = 0;

    for (let i = 0; i < pond.length; i++) {
      const p = parseFloat(pond[i].value) / 100;
      const n = parseFloat(note[i].value);
      const score = (p * n).toFixed(2);
      results[i].innerText = score;
      total += parseFloat(score);
    }

    document.getElementById("total").innerText = total.toFixed(2);
  }

  document.querySelectorAll("input").forEach(input => {
    input.addEventListener("input", calculer);
  });

  calculer();

</script>
